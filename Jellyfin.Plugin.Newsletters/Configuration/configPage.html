<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Newsletters</title>
</head>
<body>
    <div id="NewsletterConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form id="NewsletterConfigForm">
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label class="emby-checkbox-label">
                            <input id="DebugMode" name="DebugMode" type="checkbox" is="emby-checkbox" />
                            <span>Debug Mode</span>
                        </label>
                    </div>
                    <div id="CommonDetails">
                        <div class="inputContainer" id="LocalHostname">
                            <label class="inputLabel inputLabelUnfocused" for="Hostname">Server URL:</label>
                            <input id="Hostname" name="Hostname" type="text" is="emby-input" />
                            <div class="fieldDescription">
                                Hostname for your JF server that is accessible from outside your network. Ensure to include http[s]:// and port number (if applicable). <b>DO NOT include a trailing slash '/'</b>. 
                                <br>
                                i.e: https://myServerDNSName.com:8096
                            </div>
                        </div>
                    </div>
                    <div id="LibrarySelection">
                        <b style="margin-bottom: 5px;">Types of items to scan:</b> 
                        <table>
                            <tr>
                                <td>
                                    <div class="checkboxContainer checkboxContainer-withDescription">
                                        <label class="emby-checkbox-label">
                                            <input id="SeriesEnabled" name="SeriesEnabled" type="checkbox" is="emby-checkbox" />
                                            <span>Series</span>
                                        </label>
                                    </div>
                                </td>
                                <td>
                                    <div class="checkboxContainer checkboxContainer-withDescription">
                                        <label class="emby-checkbox-label">
                                            <input id="MoviesEnabled" name="MoviesEnabled" type="checkbox" is="emby-checkbox" />
                                            <span>Movies</span>
                                        </label>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="NewsletterEventSettings">
                        <b style="margin-bottom: 5px;">Newsletter Event Settings:</b>
                        <table>
                            <tr>
                                <td>
                                    <div class="checkboxContainer checkboxContainer-withDescription">
                                        <label class="emby-checkbox-label">
                                            <input id="NewsletterOnItemAddedEnabled" name="NewsletterOnItemAddedEnabled" type="checkbox" is="emby-checkbox" />
                                            <span>Send newsletter when items are added</span>
                                        </label>
                                    </div>
                                </td>
                                <td>
                                    <div class="checkboxContainer checkboxContainer-withDescription">
                                        <label class="emby-checkbox-label">
                                            <input id="NewsletterOnItemUpdatedEnabled" name="NewsletterOnItemUpdatedEnabled" type="checkbox" is="emby-checkbox" />
                                            <span>Send newsletter when items are updated</span>
                                        </label>
                                    </div>
                                </td>
                                <td>
                                    <div class="checkboxContainer checkboxContainer-withDescription">
                                        <label class="emby-checkbox-label">
                                            <input id="NewsletterOnItemDeletedEnabled" name="NewsletterOnItemDeletedEnabled" type="checkbox" is="emby-checkbox" />
                                            <span>Send newsletter when items are deleted</span>
                                        </label>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <!-- <div class="inputContainer" id="BodyTemplate" style="display: none;"> -->
                    <!-- Newsletter Formatting -->
                    <!-- Main Body -->
                    <div id="HiddenDetails" name="HtmlFormatting" class="DropdownSection">
                        <details>
                            <summary>Newsletter HTML Format</summary><br>
                            <div class="inputContainer" id="BodyTemplate">
                                <label class="inputLabel inputLabelUnfocused" for="Body">Body Html:</label>
                                <div class="fieldDescription">
                                    See below for Field Names to use in your custom HTML:<br>
                                    {Date} - The date of Newsletter generation. <br>
                                    {EntryData} - This is the insert of the custom HTML from the field EntryData below. If not used, email will have no data. <br>
                                </div>
                                <textarea id="Body" name="Body" dataname="Body" style="width: 100%; height: 400px"></textarea>
                                <div class="fieldDescription">HTML formatting for main Body of email. Defaults to a predefined template</div>
                            </div>
                            <!-- Entry/Cell Data -->
                            <div class="inputContainer" id="EntryTemplate">
                                <label class="inputLabel inputLabelUnfocused" for="Entry">EntryData Html:</label>
                                <div class="fieldDescription">
                                    See below for Field Names to use in your custom HTML:<br>
                                    {ImageURL} - The physical URL for the image to be used. For HTML formatting, should be used within a 'img' tag as it's source. <br>
                                    {Title} - Title of the Series/Movie for the entry <br>
                                    {SeasonEpsInfo} - Season-Episode information for a series (Doesn't show for movies) <br>
                                    {SeriesOverview} - The series/movie overview <br>
                                </div>
                                <textarea id="Entry" name="Entry" dataname="Entry" style="width: 100%; height: 400px"></textarea>
                                <div class="fieldDescription">Html formatting for each Entry (episode, movie, etc.) for the email. Defaults to a predefined template</div>
                            </div>
                        </details>
                    </div>
                    <br>
                    
                    <!-- Scraper configuration Details -->
                    <div id="HiddenDetails" name="ScraperConfig" class="DropdownSection">
                        <details>
                            <summary>Scraper Config</summary><br>
                            <div class="selectContainer">
                                <label class="selectLabel" for="HostingSelector">Poster Type:</label>
                                <select is="emby-select" id="HostingSelector" name="HostingSelector" class="emby-select-withcolor emby-select">
                                    <option id="defaultTmdb" value="tmdb">TMDB Poster (Default)</option>
                                    <option id="localJFHosting" value="attachment">Local Poster Images</option>
                                </select>
                            </div>
                            <hr>
                            <div id="MaxEmailSizeContainer" name="options" style="display: none;">
                                <div class="inputContainer" id="MaxEmailSize">
                                    <label class="inputLabel inputLabelUnfocused" for="EmailSize">Maximum Email Size:</label>
                                    <input id="EmailSize" name="EmailSize" type="text" type="number" is="emby-input" min="5" />
                                    <div class="fieldDescription">
                                        Enter the maximum email size allowed by your email provider (in MB).
                                        For reliable delivery, set this value slightly below your provider's official limit (e.g., use 20 MB if your provider supports up to 25 MB).
                                        <b>Default: 15 MB</b>
                                    </div>
                                </div>
                            </div>
                            <div class="fieldDescription">
                                Choose how newsletter posters should be included in the emails.<br>
                                <b>TMDB</b>: Uses image URLs from TheMovieDB (default, smallest emails).<br>
                                <b>Local Attachments</b>: Embeds images directly in the email (larger messages).
                            </div>
                        </details>
                    </div>
                    <br>
                    <!-- SMTP Server Details -->
                    <div id="HiddenDetails" name="ServerDetails" class="DropdownSection">
                        <details>
                            <summary>Email & SMTP Config</summary><br>
                            <div class="inputContainer" id="ToAddress">
                                <label class="inputLabel inputLabelUnfocused" for="VisibleToAddr">To Address:</label>
                                <input id="VisibleToAddr" name="VisibleToAddr" type="text" is="emby-input" />
                                <div class="fieldDescription">Recipient's email to recieve newsletter. If more than 1, seperate with commas</div>
                            </div>
                            <div class="inputContainer" id="BCCAddress">
                                <label class="inputLabel inputLabelUnfocused" for="ToAddr">BCC Address:</label>
                                <input id="ToAddr" name="ToAddr" type="text" is="emby-input" />
                                <div class="fieldDescription">Recipient's email to recieve newsletter(in BCC). If more than 1, seperate with commas</div>
                            </div>
                            <div class="inputContainer" id="FromAddress">
                                <label class="inputLabel inputLabelUnfocused" for="FromAddr">From Address:</label>
                                <input id="FromAddr" name="FromAddr" type="text" is="emby-input" />
                                <div class="fieldDescription">The address that the newsletter will come from</div>
                            </div>
                            <div class="inputContainer" id="SubjectTemplate">
                                <label class="inputLabel inputLabelUnfocused" for="Subject">Subject:</label>
                                <input id="Subject" name="Subject" type="text" is="emby-input" />
                                <div class="fieldDescription">Subject field of the newsletter (Default: 'Jellyfin Newsletter)</div>
                            </div>
                            <div class="inputContainer" id="SMTPServerAddress">
                                <label class="inputLabel inputLabelUnfocused" for="SMTPServer">SMTP Server Address:</label>
                                <input id="SMTPServer" name="SMTPServerName" type="text" is="emby-input" />
                                <div class="fieldDescription">Server address of the SMTP server/service you want to use (i.e. smtp.gmail.com)</div>
                            </div>
                            <div class="inputContainer" id="SMTPPortNum">
                                <label class="inputLabel inputLabelUnfocused" for="SMTPPort">SMTP Port:</label>
                                <input id="SMTPPort" name="SMTPPortNum" type="number" is="emby-input" min="0" />
                                <div class="fieldDescription">SMTP Port that the server/service listed above uses (i.e. 587)</div>
                            </div>
                            <div class="inputContainer" id="SMTPUsername">
                                <label class="inputLabel inputLabelUnfocused" for="SMTPUser">SMTP Username:</label>
                                <input id="SMTPUser" name="SMTPUsername" type="text" is="emby-input" />
                                <div class="fieldDescription">Username/email that will be used to login to the SMTP server</div>
                            </div>
                            <div class="inputContainer" id="SMTPPassword">
                                <label class="inputLabel inputLabelUnfocused" for="SMTPPass">SMTP Password:</label>
                                <input id="SMTPPass" name="SMTPPassword" type="text" is="emby-input" />
                                <div class="fieldDescription">Password that will be used to login to the SMTP server</div>
                            </div>
                            <button id="testButton" is="emby-button" type="button" class="raised block emby-button">
                                <span>Test</span>
                            </button>
                        </details>
                    </div>


                    <br>
                    <!-- Discord Webhook Details -->
                    <div id="HiddenDetails" name="WebhookDetails" class="DropdownSection">
                        <details>
                            <summary>Discord Config</summary><br>
                            <div class="inputContainer" id="DiscordWebhookAddress">
                                <label class="inputLabel inputLabelUnfocused" for="DiscordWebhookURL">Webook URL:</label>
                                <input id="DiscordWebhookURL" name="DiscordWebhookAddress" type="text" is="emby-input" />
                                <div class="fieldDescription">Discord webhook URL that you want to use.</div>
                            </div>
                            <div class="inputContainer" id="DiscordWKName">
                                <label class="inputLabel inputLabelUnfocused" for="DiscordWebhookName">Webhook Name:</label>
                                <input id="DiscordWebhookName" name="DiscordWKName" type="text" is="emby-input" />
                                <div class="fieldDescription">Name that you want to give to discord webhook. Defaults to "Jellyfin Newsletter"</div>
                            </div>
                            <div id="DiscordFieldSelection">
                                <table>
                                    <tr>
                                        <th colspan="2">Select the fields that you want to be part of the message:</th>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="checkboxContainer checkboxContainer-withDescription">
                                                <label class="emby-checkbox-label">
                                                    <input id="DiscordDescriptionEnabled" name="DiscordDescriptionEnabled" type="checkbox" is="emby-checkbox" />
                                                    <span>Description</span>
                                                </label>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="checkboxContainer checkboxContainer-withDescription">
                                                <label class="emby-checkbox-label">
                                                    <input id="DiscordThumbnailEnabled" name="DiscordThumbnailEnabled" type="checkbox" is="emby-checkbox" />
                                                    <span>Thumbnail</span>
                                                </label>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="checkboxContainer checkboxContainer-withDescription">
                                                <label class="emby-checkbox-label">
                                                    <input id="DiscordRatingEnabled" name="DiscordRatingEnabled" type="checkbox" is="emby-checkbox" />
                                                    <span>Rating</span>
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="checkboxContainer checkboxContainer-withDescription">
                                                <label class="emby-checkbox-label">
                                                    <input id="DiscordPGRatingEnabled" name="DiscordPGRatingEnabled" type="checkbox" is="emby-checkbox" />
                                                    <span>PG Rating</span>
                                                </label>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="checkboxContainer checkboxContainer-withDescription">
                                                <label class="emby-checkbox-label">
                                                    <input id="DiscordDurationEnabled" name="DiscordDurationEnabled" type="checkbox" is="emby-checkbox" />
                                                    <span>Duration</span>
                                                </label>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="checkboxContainer checkboxContainer-withDescription">
                                                <label class="emby-checkbox-label">
                                                    <input id="DiscordEpisodesEnabled" name="DiscordEpisodesEnabled" type="checkbox" is="emby-checkbox" />
                                                    <span>Episodes List (Will only affect in Series)</span>
                                                </label>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="inputContainer">
                                <table style="width: 100%; table-layout: fixed;">
                                    <tr>
                                        <th colspan="2">Series Add Event</th>
                                        <th colspan="2">Series Delete Event</th>
                                        <th colspan="2">Series Update Event</th>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <input id="DiscordSeriesAddEmbedColor" name="DiscordSeriesAddEmbedColor" type="color" is="emby-input"
                                                style="height: 2.2em; width: 100%;" />
                                        </td>
                                        <td colspan="2">
                                            <input id="DiscordSeriesDeleteEmbedColor" name="DiscordSeriesDeleteEmbedColor" type="color" is="emby-input"
                                                style="height: 2.2em; width: 100%;" />
                                        </td>
                                        <td colspan="2">
                                            <input id="DiscordSeriesUpdateEmbedColor" name="DiscordSeriesUpdateEmbedColor" type="color" is="emby-input"
                                                style="height: 2.2em; width: 100%;" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <br>
                            <div class="inputContainer">
                                <table style="width: 100%; table-layout: fixed;">
                                    <tr>
                                        <th colspan="2">Movies Add Event</th>
                                        <th colspan="2">Movies Delete Event</th>
                                        <th colspan="2">Movies Update Event</th>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <input id="DiscordMoviesAddEmbedColor" name="DiscordMoviesAddEmbedColor" type="color" is="emby-input"
                                                style="height: 2.2em; width: 100%;" />
                                        </td>
                                        <td colspan="2">
                                            <input id="DiscordMoviesDeleteEmbedColor" name="DiscordMoviesDeleteEmbedColor" type="color" is="emby-input"
                                                style="height: 2.2em; width: 100%;" />
                                        </td>
                                        <td colspan="2">
                                            <input id="DiscordMoviesUpdateEmbedColor" name="DiscordMoviesUpdateEmbedColor" type="color" is="emby-input"
                                                style="height: 2.2em; width: 100%;" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <button id="testButtonDiscord" is="emby-button" type="button" class="raised block emby-button">
                                <span>Test Discord</span>
                            </button>
                        </details>
                    </div>

                        <!-- buttons -->
                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <style>
            #HiddenDetails {
                border-width: 2px;
                border-style: solid;
                border-color: white;
                padding: 10px 10px 10px 10px;
            }
            #testButton, #testButtonDiscord {
                background: #C1C1BF;
            }
            td {
                padding-right: 10px;
            }
            .DropdownSection {
                cursor: pointer;
            }
        </style>
        <script type="text/javascript">
            var NewsletterConfig = {
                pluginUniqueId: '60f478ab-2dd6-4ea0-af10-04d033f75979'
            };

            // function hideScraperConfig() {
            //     let options = document.getElementsByName("options");
            //     options.forEach((option) => {
            //         option.style.display = 'none';
            //     });
            // }

            // function showScraperConfig(id) {
            //     document.getElementById(id).style.display = 'block';
            // }

            function updateMaxEmailSizeVisibility() {
                var posterType = document.querySelector('#HostingSelector').value;
                var maxEmailSizeDiv = document.getElementById('MaxEmailSizeContainer');
                if (posterType === "attachment") {
                    maxEmailSizeDiv.style.display = '';
                } else {
                    maxEmailSizeDiv.style.display = 'none';
                }
            }
            
            function saveConfig() {
                //console.log("test");
                ApiClient.getPluginConfiguration(NewsletterConfig.pluginUniqueId).then(function (config) {
                    config.DebugMode = document.querySelector('#DebugMode').checked;
                    //serverDetails
                    config.SMTPServer = document.querySelector('#SMTPServer').value;
                    config.SMTPPort = document.querySelector('#SMTPPort').value;
                    config.SMTPUser = document.querySelector('#SMTPUser').value;
                    config.SMTPPass = document.querySelector('#SMTPPass').value;
                    //discordWebhookDetails
                    config.DiscordWebhookURL = document.querySelector('#DiscordWebhookURL').value;
                    config.DiscordWebhookName = document.querySelector('#DiscordWebhookName').value;
                    config.DiscordDescriptionEnabled = document.querySelector('#DiscordDescriptionEnabled').checked;
                    config.DiscordThumbnailEnabled = document.querySelector('#DiscordThumbnailEnabled').checked;
                    config.DiscordRatingEnabled = document.querySelector('#DiscordRatingEnabled').checked;
                    config.DiscordPGRatingEnabled = document.querySelector('#DiscordPGRatingEnabled').checked;
                    config.DiscordDurationEnabled = document.querySelector('#DiscordDurationEnabled').checked;
                    config.DiscordEpisodesEnabled = document.querySelector('#DiscordEpisodesEnabled').checked;
                    config.DiscordSeriesAddEmbedColor = document.querySelector('#DiscordSeriesAddEmbedColor').value;
                    config.DiscordSeriesDeleteEmbedColor = document.querySelector('#DiscordSeriesDeleteEmbedColor').value;
                    config.DiscordSeriesUpdateEmbedColor = document.querySelector('#DiscordSeriesUpdateEmbedColor').value;
                    config.DiscordMoviesAddEmbedColor = document.querySelector('#DiscordMoviesAddEmbedColor').value;
                    config.DiscordMoviesDeleteEmbedColor = document.querySelector('#DiscordMoviesDeleteEmbedColor').value;
                    config.DiscordMoviesUpdateEmbedColor = document.querySelector('#DiscordMoviesUpdateEmbedColor').value;
                    //emailDetails
                    config.ToAddr = document.querySelector('#ToAddr').value;
                    config.VisibleToAddr = document.querySelector('#VisibleToAddr').value;
                    config.FromAddr = document.querySelector('#FromAddr').value;
                    config.Subject = document.querySelector('#Subject').value;
                    //emailHtmlFormatting
                    config.Body = document.querySelector('#Body').value;
                    config.Entry = document.querySelector('#Entry').value;
                    //librariesEnabled
                    config.SeriesEnabled = document.querySelector('#SeriesEnabled').checked;
                    config.MoviesEnabled = document.querySelector('#MoviesEnabled').checked;
                    // scraperConfig
                    config.PosterType = document.querySelector('#HostingSelector').value;
                    config.EmailSize = document.querySelector('#EmailSize').value;
                    //config.ApiKey = document.querySelector('#ApiKey').value;
                    //hosting options
                    config.Hostname = document.querySelector('#Hostname').value;
                    
                    // newsletter event settings
                    config.NewsletterOnItemAddedEnabled = document.querySelector('#NewsletterOnItemAddedEnabled').checked;
                    config.NewsletterOnItemUpdatedEnabled = document.querySelector('#NewsletterOnItemUpdatedEnabled').checked;
                    config.NewsletterOnItemDeletedEnabled = document.querySelector('#NewsletterOnItemDeletedEnabled').checked;

                    ApiClient.updatePluginConfiguration(NewsletterConfig.pluginUniqueId, config).then(function (result) {
                        Dashboard.processPluginConfigurationUpdateResult(result);
                        console.log("RESULT: ", result);
                    });
                });

            }

            function loadConfig() {
                ApiClient.getPluginConfiguration(NewsletterConfig.pluginUniqueId).then(function (config) {
                    console.log("Populating Page..");
                    document.querySelector('#DebugMode').checked = config.DebugMode;
                    //serverDetails
                    document.querySelector('#SMTPServer').value = config.SMTPServer;
                    document.querySelector('#SMTPPort').value = config.SMTPPort;
                    document.querySelector('#SMTPUser').value = config.SMTPUser;
                    document.querySelector('#SMTPPass').value = config.SMTPPass;
                    //discordWebhookDetails
                    document.querySelector('#DiscordWebhookURL').value = config.DiscordWebhookURL;
                    document.querySelector('#DiscordWebhookName').value = config.DiscordWebhookName;
                    document.querySelector('#DiscordDescriptionEnabled').checked = config.DiscordDescriptionEnabled;
                    document.querySelector('#DiscordThumbnailEnabled').checked = config.DiscordThumbnailEnabled;
                    document.querySelector('#DiscordRatingEnabled').checked = config.DiscordRatingEnabled;
                    document.querySelector('#DiscordPGRatingEnabled').checked = config.DiscordPGRatingEnabled;
                    document.querySelector('#DiscordDurationEnabled').checked = config.DiscordDurationEnabled;
                    document.querySelector('#DiscordEpisodesEnabled').checked = config.DiscordEpisodesEnabled;
                    document.querySelector('#DiscordSeriesAddEmbedColor').value = config.DiscordSeriesAddEmbedColor;
                    document.querySelector('#DiscordSeriesDeleteEmbedColor').value = config.DiscordSeriesDeleteEmbedColor;
                    document.querySelector('#DiscordSeriesUpdateEmbedColor').value = config.DiscordSeriesUpdateEmbedColor;
                    document.querySelector('#DiscordMoviesAddEmbedColor').value = config.DiscordMoviesAddEmbedColor;
                    document.querySelector('#DiscordMoviesDeleteEmbedColor').value = config.DiscordMoviesDeleteEmbedColor;
                    document.querySelector('#DiscordMoviesUpdateEmbedColor').value = config.DiscordMoviesUpdateEmbedColor;
                    //emailDetails
                    document.querySelector('#VisibleToAddr').value = config.VisibleToAddr;
                    document.querySelector('#ToAddr').value = config.ToAddr;
                    document.querySelector('#FromAddr').value = config.FromAddr;
                    document.querySelector('#Subject').value = config.Subject;
                    //emailHtmlFormatting
                    document.querySelector('#Body').value = config.Body;
                    document.querySelector('#Entry').value = config.Entry;
                    //librariesEnabled
                    document.querySelector('#SeriesEnabled').checked = config.SeriesEnabled;
                    document.querySelector('#MoviesEnabled').checked = config.MoviesEnabled;
                    // scraperConfig
                    document.querySelector('#HostingSelector').value = config.PosterType;
                    document.querySelector('#EmailSize').value = config.EmailSize;
                    // hideScraperConfig();
                    // showScraperConfig(config.PHType);
                    //document.querySelector('#ApiKey').value = config.ApiKey;
                    //hosting options
                    document.querySelector('#Hostname').value = config.Hostname;
                    
                    // newsletter event settings
                    document.querySelector('#NewsletterOnItemAddedEnabled').checked = config.NewsletterOnItemAddedEnabled;
                    document.querySelector('#NewsletterOnItemUpdatedEnabled').checked = config.NewsletterOnItemUpdatedEnabled;
                    document.querySelector('#NewsletterOnItemDeletedEnabled').checked = config.NewsletterOnItemDeletedEnabled;

                    updateMaxEmailSizeVisibility();

                    Dashboard.hideLoadingMsg();
                });

            }

            document.querySelector('#NewsletterConfigPage')
                .addEventListener('pageshow', function() {
                    Dashboard.showLoadingMsg();
                    loadConfig();
                });

            document.querySelector('#NewsletterConfigForm')
                .addEventListener('submit', function(e) {
                Dashboard.showLoadingMsg();
                saveConfig();

                e.preventDefault();
                return false;
            });

            // button to test SMTP configration
            document.querySelector('#testButton')
                .addEventListener('click', function(e) {
                Dashboard.showLoadingMsg();
                // saveConfig();
                console.log("Test mail button pressed!");
                // Configure test notification
                ApiClient.getPluginConfiguration(NewsletterConfig.pluginUniqueId).then(function (config) {
                    console.log("TEST: ", config);
                    let url = ApiClient.getUrl('Smtp/SendTestMail');
                    console.log("ServerAddr: ", ApiClient.serverAddress());
                    console.log("URL: ",url);
                    let data = JSON.stringify(config);
                    ApiClient.ajax({ type: 'POST', url, data, contentType: 'application/json' });
                });
                Dashboard.hideLoadingMsg();
                e.preventDefault();
                alert("Test email sent! In case email doesn't arrive, check your SMTP configuration and server logs for errors.");
                return false;
            });

            document.querySelector('#testButtonDiscord')
                .addEventListener('click', function(e) {
                Dashboard.showLoadingMsg();
                // saveConfig();
                console.log("Test discord message button pressed!");
                // Configure test notification
                ApiClient.getPluginConfiguration(NewsletterConfig.pluginUniqueId).then(function (config) {
                    console.log("TEST: ", config);
                    let url = ApiClient.getUrl('Discord/SendDiscordTestMessage');
                    // console.log("ServerAddr: ", ApiClient.serverAddress());
                    // console.log("URL: ",url);
                    let data = JSON.stringify(config);
                    ApiClient.ajax({ type: 'POST', url, data, contentType: 'application/json' });
                });
                Dashboard.hideLoadingMsg();
                e.preventDefault();
                alert("Test discord message sent! In case message doesn't arrive, check your Discord webhook configuration and server logs for errors.");
                return false;
            });
            
            // Scrapper config
            document.querySelector('#HostingSelector')
                .addEventListener('change', function() {
                updateMaxEmailSizeVisibility();
            });

        </script>
    </div>
</body>
</html>
